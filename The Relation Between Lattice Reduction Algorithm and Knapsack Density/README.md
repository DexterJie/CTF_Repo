CTF中出现的背包问题通常形如：



$$
S = \sum_{i=0}^{n-1}x_iM_i
$$


其中 $M$为背包的公钥， $S$为密文，记 $n = \mathrm{len}(M)$，背包密度 $d = \frac{n}{\log_2(\max(M))}$。

求解过程其实就是用公钥序列 $M= (M_1,M_2,...,M_n)$构造两种格

第一种是 $(n+1)\times (n+1)$的格：



$$
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix}
$$


其线性关系是



$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix} = \begin{pmatrix}
x_1 & x_2 & ... & x_n & 0
\end{pmatrix}
$$



第二种也是 $(n+1)\times(n+1)$的格，只不过把对角线元素替换为2，并在最后一行添加1：



$$
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 & M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
$$


这个对应的线性组合是



$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 &M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
=\
\begin{pmatrix}
2x_1-1 & 2x_2-1 & ... & 2x_n-1 & 0
\end{pmatrix}
$$



第二种比第一种好在第二种格的行列式会更大一些

上面两个格一般在用的时候会在最后一列乘上`N = ceil(sqrt(n))`

都说当密度 $d < 0.9408$时，可以用LLL、BKZ算法来完成求解（**我感觉这个范围过于草率，做了各个比赛的背包题之后有个疑问：密度在什么范围用LLL，在什么范围用BKZ，block_size又该怎么选取**），于是我对 $0.4 \le d \le 0.94$这个范围的背包进行了测试，并得到如下结果。

对于每个密度我都取了500组数据并进行5次测试，成功率取的是5次下来的平均值（当`block_size=26`的时候，密度大于0.8的数据只取10组，因为速度太慢了，只好把数据量减少一点）

| Density | Successfully attack with LLL and Lattice1 | Successfully attack with BKZ(block_size=20) and Lattice1 | Successfully attack with BKZ(block_size=26) and Lattice1 | Successfully attack with LLL and Lattice2 | Successfully attack with BKZ(block_size=20) and Lattice2 | Successfully attack with BKZ(block_size=26) and Lattice2 |
| ------- | ----------------------------------------- | -------------------------------------------------------- | -------------------------------------------------------- | ----------------------------------------- | -------------------------------------------------------- | -------------------------------------------------------- |
| 0.4     | 100%                                      | 100.00%                                                  |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.41    | 100%                                      | 100.00%                                                  |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.42    | 100%                                      | 99.88%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.43    | 99.96%                                    | 99.60%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.44    | 99.68%                                    | 98.96%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.45    | 98.56%                                    | 98.32%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.46    | 94.96%                                    | 96.68%                                                   |                                                          | 99.96%                                    | 100%                                                     | 100%                                                     |
| 0.47    | 82.12%                                    | 93.60%                                                   |                                                          | 99.84%                                    | 100%                                                     | 100%                                                     |
| 0.48    | 70.64%                                    | 90.76%                                                   |                                                          | 99.64%                                    | 100%                                                     | 100%                                                     |
| 0.49    | 63.04%                                    | 87.64%                                                   |                                                          | 99.24%                                    | 100%                                                     | 100%                                                     |
| 0.50    | 47.80%                                    |                                                          |                                                          | 97.60%                                    | 100%                                                     | 100%                                                     |
| 0.51    | 27.36%                                    |                                                          |                                                          | 95.44%                                    | 100%                                                     | 100%                                                     |
| 0.52    | 23.44%                                    |                                                          |                                                          | 91.68%                                    | 100%                                                     | 100%                                                     |
| 0.53    | 11.72%                                    |                                                          |                                                          | 84.04%                                    | 100%                                                     | 100%                                                     |
| 0.54    | 6.16%                                     |                                                          |                                                          | 75.68%                                    | 100%                                                     | 100%                                                     |
| 0.55    | 3.40%                                     |                                                          |                                                          | 66.48%                                    | 100%                                                     | 100%                                                     |
| 0.56    | 2.64%                                     |                                                          |                                                          | 53.56%                                    | 100%                                                     | 100%                                                     |
| 0.57    | 1.56%                                     |                                                          |                                                          | 42.60%                                    | 100%                                                     | 100%                                                     |
| 0.58    | 1.04%                                     |                                                          |                                                          | 31.92%                                    | 100%                                                     | 100%                                                     |
| 0.59    | 0.72%                                     |                                                          |                                                          | 21.00%                                    | 100%                                                     | 100%                                                     |
| 0.60    | 0.48%                                     |                                                          |                                                          | 13.44%                                    | 100%                                                     | 100%                                                     |
| 0.61    | 0.04%                                     |                                                          |                                                          | 7.20%                                     | 99.96%                                                   | 100%                                                     |
| 0.62    | 0.24%                                     |                                                          |                                                          | 4.24%                                     | 99.88%                                                   | 100%                                                     |
| 0.63    | 0.00%                                     |                                                          |                                                          | 1.84%                                     | 99.72%                                                   | 100%                                                     |
| 0.64    | 0.00%                                     |                                                          |                                                          | 0.76%                                     | 99.20%                                                   | 100%                                                     |
| 0.65    | 0.00%                                     |                                                          |                                                          | 0.28%                                     | 98.60%                                                   | 100%                                                     |
| 0.66    | 0.04%                                     |                                                          |                                                          | 0.20%                                     | 96.72%                                                   | 99.96%                                                   |
| 0.67    | 0.00%                                     |                                                          |                                                          | 0.12%                                     | 93.44%                                                   | 99.88%                                                   |
| 0.68    | 0.00%                                     |                                                          |                                                          | 0.00%                                     | 89.44%                                                   | 99.52%                                                   |
| 0.69    | 0.00%                                     |                                                          |                                                          | 0.00%                                     | 83.44%                                                   | 99.60%                                                   |
| 0.70    | 0.00%                                     |                                                          |                                                          | 0.00%                                     | 78.16%                                                   | 98.92%                                                   |
| 0.71    |                                           |                                                          |                                                          | 0.00%                                     | 66.08%                                                   | 97.84%                                                   |
| 0.72    |                                           |                                                          |                                                          | 0.00%                                     | 56.12%                                                   | 95.96%                                                   |
| 0.73    |                                           |                                                          |                                                          | 0.00%                                     | 44.28%                                                   | 93.92%                                                   |
| 0.74    |                                           |                                                          |                                                          | 0.00%                                     | 34.60%                                                   | 90.04%                                                   |
| 0.75    |                                           |                                                          |                                                          | 0.00%                                     | 25.32%                                                   | 84.96%                                                   |
| 0.76    |                                           |                                                          |                                                          | 0.00%                                     | 17.72%                                                   | 76.60%                                                   |
| 0.77    |                                           |                                                          |                                                          | 0.00%                                     | 12.12%                                                   | 66.44%                                                   |
| 0.78    |                                           |                                                          |                                                          | 0.00%                                     | 7.84%                                                    | 58.56%                                                   |
| 0.79    |                                           |                                                          |                                                          | 0.00%                                     | 4.48%                                                    | 47.48%                                                   |
| 0.80    |                                           |                                                          |                                                          | 0.00%                                     | 2.12%                                                    | 35.68%                                                   |
| 0.81    |                                           |                                                          |                                                          | 0.00%                                     | 0.96%                                                    | 24.92%                                                   |
| 0.82    |                                           |                                                          |                                                          | 0.00%                                     | 0.32%                                                    | 17.00%                                                   |
| 0.83    |                                           |                                                          |                                                          | 0.00%                                     | 0.08%                                                    | 11.84%                                                   |
| 0.84    |                                           |                                                          |                                                          | 0.00%                                     | 0.04%                                                    | 7.00%                                                    |
| 0.85    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 4.56%                                                    |
| 0.86    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 2.32%                                                    |
| 0.87    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 0.68%                                                    |
| 0.88    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 0.40%                                                    |
| 0.89    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 0.08%                                                    |
| 0.90    |                                           |                                                          |                                                          | 0.00%                                     | 0.00%                                                    | 0.00%                                                    |
| 0.91    |                                           |                                                          |                                                          |                                           |                                                          |                                                          |
| 0.92    |                                           |                                                          |                                                          |                                           |                                                          |                                                          |
| 0.93    |                                           |                                                          |                                                          |                                           |                                                          |                                                          |
| 0.94    |                                           |                                                          |                                                          |                                           |                                                          |                                                          |

数据持续更新....
