CTF中出现的背包问题通常形如：



$$
S = \sum_{i=0}^{n-1}x_iM_i
$$


其中 $M$为背包的公钥， $S$为密文，记 $n = \mathrm{len}(M)$，背包密度 $d = \frac{n}{\log_2(\max(M))}$。

求解过程其实就是用公钥序列 $M= (M_1,M_2,...,M_n)$构造两种格

第一种是 $(n+1)\times (n+1)$的格：



$$
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix}
$$


其线性关系是



$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix} = \begin{pmatrix}
x_1 & x_2 & ... & x_n & 0
\end{pmatrix}
$$



第二种也是 $(n+1)\times(n+1)$的格，只不过把对角线元素替换为2，并在最后一行添加1：



$$
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 & M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
$$


这个对应的线性组合是



$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 &M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
=\
\begin{pmatrix}
2x_1-1 & 2x_2-1 & ... & 2x_n-1 & 0
\end{pmatrix}
$$



第二种比第一种好在第二种格的行列式会更大一些

上面两个格一般在用的时候会在最后一列乘上`N = ceil(sqrt(n))`

都说当密度 $d < 0.9408$时，可以用LLL、BKZ算法来完成求解（**我感觉这个范围过于草率，做了各个比赛的背包题之后有个疑问：密度在什么范围用LLL，在什么范围用BKZ，block_size又该怎么选取**），于是我对 $0.4 \le d \le 0.94$这个范围的背包进行了测试，并得到如下结果。

对于每个密度我都取了500组数据并进行5次测试，成功率取的是5次下来的平均值（当`block_size=26`的时候，密度大于0.8的数据只取10组，因为速度太慢了，只好把数据量减少一点）

| Density | Successfully attack with LLL and Lattice1 | Successfully attack with BKZ(block_size=20) and Lattice1 | Successfully attack with BKZ(block_size=26) and Lattice1 | Successfully attack with LLL and Lattice2 | Successfully attack with BKZ(block_size=20) and Lattice2 | Successfully attack with BKZ(block_size=26) and Lattice2 |
| ------- | ----------------------------------------- | -------------------------------------------------------- | -------------------------------------------------------- | ----------------------------------------- | -------------------------------------------------------- | -------------------------------------------------------- |
| 0.4     | 99.64%                                    | 100%                                                     |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.41    | 99.52%                                    | 99.92%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.42    | 98.08%                                    | 99.76%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.43    | 96.56%                                    | 99.64%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.44    | 93.76%                                    | 98.16%                                                   |                                                          | 99.96%                                    | 100%                                                     | 100%                                                     |
| 0.45    | 89.40%                                    | 97.08%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.46    | 85.28%                                    | 95.60%                                                   |                                                          | 100%                                      | 100%                                                     | 100%                                                     |
| 0.47    | 78.00%                                    | 92.40%                                                   |                                                          | 99.76%                                    | 100%                                                     | 100%                                                     |
| 0.48    | 70.12%                                    | 88.84%                                                   |                                                          | 99.36%                                    | 100%                                                     | 100%                                                     |
| 0.49    | 62.80%                                    | 84.00%                                                   |                                                          | 98.00%                                    | 100%                                                     | 100%                                                     |
| 0.50    | 53.80%                                    | 76.72%                                                   |                                                          | 96.32%                                    | 100%                                                     | 100%                                                     |
| 0.51    | 43.84%                                    | 70.84%                                                   |                                                          | 90.84%                                    | 100%                                                     | 100%                                                     |
| 0.52    | 35.48%                                    | 65.24%                                                   |                                                          | 85.36%                                    | 100%                                                     | 100%                                                     |
| 0.53    | 27.80%                                    | 58.92%                                                   |                                                          | 76.16%                                    | 100%                                                     | 100%                                                     |
| 0.54    | 19.84%                                    | 51.36%                                                   |                                                          | 66.04%                                    | 99.92%                                                   | 100%                                                     |
| 0.55    | 14.72%                                    | 43.36%                                                   |                                                          | 55.32%                                    | 99.92%                                                   | 100%                                                     |
| 0.56    | 9.16%                                     | 38.24%                                                   |                                                          | 43.32%                                    | 99.48%                                                   | 100%                                                     |
| 0.57    | 6.64%                                     | 29.80%                                                   |                                                          | 30.48%                                    | 98.24%                                                   | 100%                                                     |
| 0.58    | 4.04%                                     | 24.56%                                                   |                                                          | 21.88%                                    | 97.32%                                                   | 100%                                                     |
| 0.59    | 3.08%                                     | 18.96%                                                   |                                                          | 13.60%                                    | 94.28%                                                   | 100%                                                     |
| 0.60    | 1.56%                                     | 16.16%                                                   |                                                          | 7.68%                                     | 89.80%                                                   | 100%                                                     |
| 0.61    | 1.12%                                     | 12.16%                                                   |                                                          | 4.16%                                     | 84.72%                                                   | 100%                                                     |
| 0.62    | 0.60%                                     | 9.52%                                                    |                                                          | 1.48%                                     | 74.80%                                                   | 100%                                                     |
| 0.63    | 0.12%                                     | 5.48%                                                    |                                                          | 0.44%                                     | 67.84%                                                   | 99.96%                                                   |
| 0.64    | 0.24%                                     | 4.32%                                                    |                                                          | 0.28%                                     | 55.64%                                                   | 100%                                                     |
| 0.65    | 0%                                        | 3.12%                                                    |                                                          | 0.08%                                     | 45.96%                                                   | 99.68%                                                   |
| 0.66    | 0%                                        | 1.36%                                                    |                                                          | 0.04%                                     | 34.64%                                                   | 99.68%                                                   |
| 0.67    | 0%                                        | 0.92%                                                    |                                                          | 0%                                        | 26.84%                                                   | 99.60%                                                   |
| 0.68    | 0%                                        | 0.92%                                                    |                                                          | 0%                                        | 19.52%                                                   | 98.48%                                                   |
| 0.69    | 0%                                        | 0.36%                                                    |                                                          | 0%                                        | 12.28%                                                   | 98.00%                                                   |
| 0.70    | 0%                                        | 0.48%                                                    |                                                          | 0%                                        | 8.56%                                                    | 95.96%                                                   |
| 0.71    | 0%                                        | 0.12%                                                    |                                                          | 0%                                        | 5.76%                                                    | 93.12%                                                   |
| 0.72    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 2.88%                                                    | 89.88%                                                   |
| 0.73    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0.76%                                                    | 84.56%                                                   |
| 0.74    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0.16%                                                    | 76.44%                                                   |
| 0.75    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0.08%                                                    | 68.04%                                                   |
| 0.76    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0.08%                                                    | 57.16%                                                   |
| 0.77    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0.12%                                                    | 44.96%                                                   |
| 0.78    | 0%                                        | 0.04%                                                    |                                                          | 0%                                        | 0%                                                       | 33.52%                                                   |
| 0.79    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 25.16%                                                   |
| 0.80    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 20.00%                                                   |
| 0.81    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 4.00%                                                    |
| 0.82    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 4.00%                                                    |
| 0.83    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 2.00%                                                    |
| 0.84    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 2.00%                                                    |
| 0.85    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.86    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.87    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.88    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.89    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.90    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.91    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.92    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.93    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |
| 0.94    | 0%                                        | 0%                                                       |                                                          | 0%                                        | 0%                                                       | 0%                                                       |

