CTF中出现的背包问题通常形如：



$$
S = \sum_{i=0}^{n-1}x_iM_i
$$
其中 $M$为背包的公钥， $S$为密文，记 $n = \mathrm{len}(M)$，背包密度 $d = \frac{n}{\log_2(\max(M))}$。

求解过程其实就是用公钥序列 $M= (M_1,M_2,...,M_n)$构造两种格

第一种是 $(n+1)\times (n+1)$的格：


$$
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix}
$$
其线性关系是


$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
1 & 0 & ... & 0 & M_1\\\\
0 & 1 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 1 &M_n\\\\
0 & 0 & ... & 0 & S
\end{pmatrix}
=\
\begin{pmatrix}
x_1 & x_2 & ... & x_n & 0
\end{pmatrix}
$$


第二种也是 $(n+1)\times(n+1)$的格，只不过把对角线元素替换为2，并在最后一行添加1：


$$
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 & M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
$$
这个对应的线性组合是


$$
\begin{pmatrix}
x_1 & x_2 & ... & x_n & -1
\end{pmatrix}
\begin{pmatrix}
2 & 0 & ... & 0 & M_1\\\\
0 & 2 & ... & 0 & M_2\\\\
\vdots & \vdots & \ddots & \vdots & \vdots \\\\
0 & 0 & ... & 2 &M_n\\\\
1 & 1 & ... & 1 & S
\end{pmatrix}
=\
\begin{pmatrix}
2x_1-1 & 2x_2-1 & ... & 2x_n-1 & 0
\end{pmatrix}
$$

第二种比第一种好在第二种格的行列式会更大一些

上面两个格一般在用的时候会在最后一列乘上`N = ceil(sqrt(n))`

都说当密度$d < 0.9408$时，可以用LLL、BKZ算法来完成求解（**我感觉这个范围过于草率，做了各个比赛的背包题之后有个疑问：密度在什么范围用LLL，在什么范围用BKZ，block_size又该怎么选取**），于是我对$0.4 \le d \le 0.94$这个范围的背包进行了测试，并得到如下结果。

对于每个密度我都取了500组数据并进行5次测试，成功率取的是5次下来的平均值（当`block_size=26`的时候，密度大于0.8的数据只取10组，因为一轮下来，得8小时，只好把数据量减少一点）

| Density | Successfully attack with LLL and Lattice1 | Successfully attack with BKZ(block_size=20) and Lattice1 | Successfully attack with LLL and Lattice2 | Successfully attack with BKZ(block_size=20) and Lattice2 | Successfully attack with BKZ(block_size=26) and Lattice2 |
| ------- | ----------------------------------------- | -------------------------------------------------------- | ----------------------------------------- | -------------------------------------------------------- | -------------------------------------------------------- |
| <= 0.4  | >= 0.9964                                 | 1.0000                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.41    | 0.9952                                    | 0.9992                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.42    | 0.9808                                    | 0.9976                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.43    | 0.9656                                    | 0.9964                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.44    | 0.9376                                    | 0.9816                                                   | 0.9996                                    | 1.0000                                                   |                                                          |
| 0.45    | 0.8940                                    | 0.9708                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.46    | 0.8528                                    | 0.9560                                                   | 1.0000                                    | 1.0000                                                   |                                                          |
| 0.47    | 0.7800                                    | 0.9240                                                   | 0.9976                                    | 1.0000                                                   |                                                          |
| 0.48    | 0.7012                                    | 0.8884                                                   | 0.9936                                    | 1.0000                                                   |                                                          |
| 0.49    | 0.6280                                    | 0.8400                                                   | 0.9800                                    | 1.0000                                                   |                                                          |
| 0.50    | 0.5380                                    | 0.7672                                                   | 0.9632                                    | 1.0000                                                   |                                                          |
| 0.51    | 0.4384                                    | 0.7084                                                   | 0.9084                                    | 1.0000                                                   |                                                          |
| 0.52    | 0.3548                                    | 0.6524                                                   | 0.8536                                    | 1.0000                                                   |                                                          |
| 0.53    | 0.2780                                    | 0.5892                                                   | 0.7616                                    | 1.0000                                                   |                                                          |
| 0.54    | 0.1984                                    | 0.5136                                                   | 0.6604                                    | 0.9992                                                   |                                                          |
| 0.55    | 0.1472                                    | 0.4336                                                   | 0.5532                                    | 0.9992                                                   |                                                          |
| 0.56    | 0.0916                                    | 0.3824                                                   | 0.4332                                    | 0.9948                                                   |                                                          |
| 0.57    | 0.0664                                    | 0.2980                                                   | 0.3048                                    | 0.9824                                                   |                                                          |
| 0.58    | 0.0404                                    | 0.2456                                                   | 0.2188                                    | 0.9732                                                   |                                                          |
| 0.59    | 0.0308                                    | 0.1896                                                   | 0.1360                                    | 0.9428                                                   |                                                          |
| 0.60    | 0.0156                                    | 0.1616                                                   | 0.0768                                    | 0.8980                                                   |                                                          |
| 0.61    | 0.0112                                    | 0.1216                                                   | 0.0416                                    | 0.8472                                                   |                                                          |
| 0.62    | 0.0060                                    | 0.0952                                                   | 0.0148                                    | 0.7480                                                   |                                                          |
| 0.63    | 0.0012                                    | 0.0548                                                   | 0.0044                                    | 0.6784                                                   |                                                          |
| 0.64    | 0.0024                                    | 0.0432                                                   | 0.0028                                    | 0.5564                                                   |                                                          |
| 0.65    | 0.0000                                    | 0.0312                                                   | 0.0008                                    | 0.4596                                                   |                                                          |
| 0.66    | 0.0000                                    | 0.0136                                                   | 0.0004                                    | 0.3464                                                   |                                                          |
| 0.67    | 0.0000                                    | 0.0092                                                   | 0.0000                                    | 0.2684                                                   |                                                          |
| 0.68    | 0.0000                                    | 0.0092                                                   | 0.0000                                    | 0.1952                                                   |                                                          |
| 0.69    | 0.0000                                    | 0.0036                                                   | 0.0000                                    | 0.1228                                                   |                                                          |
| 0.70    | 0.0000                                    | 0.0048                                                   | 0.0000                                    | 0.0856                                                   |                                                          |
| 0.71    | 0.0000                                    | 0.0012                                                   | 0.0000                                    | 0.0576                                                   |                                                          |
| 0.72    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0288                                                   |                                                          |
| 0.73    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0076                                                   |                                                          |
| 0.74    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0016                                                   |                                                          |
| 0.75    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0008                                                   |                                                          |
| 0.76    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0008                                                   |                                                          |
| 0.77    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0012                                                   |                                                          |
| 0.78    | 0.0000                                    | 0.0004                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.79    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.80    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.81    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.82    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.83    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.84    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.85    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.86    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.87    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.88    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.89    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.90    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.91    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.92    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.93    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |
| 0.94    | 0.0000                                    | 0.0000                                                   | 0.0000                                    | 0.0000                                                   |                                                          |

