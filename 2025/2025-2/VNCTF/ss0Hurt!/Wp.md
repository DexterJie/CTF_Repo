![](img/1.png)

跟GPT耗了一段时间，最后的hash其实就是：

![](img/2.png)



其中$E(m) = m + 2^{mbits}$，手动添两行

![](img/3.png)



这个时候其实可以写为
$$
B = AL^{E(m)}
$$
做一个变换即可求得$L^{E(m)} \equiv B\times A^{-1}\mod p$，记为$M$

把L变为Jordan标准型然后求解矩阵DLP，参考:https://dexterjie.github.io/2024/04/26/%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/2024XYCTF/?highlight=xyc#fakeRSA

得到E(m)之后，爆破一下bits即可

> exp

```py
from Crypto.Util.number import *

n = 106743081253087007974132382690669187409167641660258665859915640694456867788135702053312073228376307091325146727550371538313884850638568106223326195447798997814912891375244381751926653858549419946547894675646011818800255999071070352934719005006228971056393128007601573916373180007524930454138943896336817929823
L = Matrix(Zmod(n),[
    [5,0,0],
    [1,5,0],
    [-5,-1,5]
])

h0 = vector(Zmod(n),[2025,208,209])
h1 = h0 * L
h2 = h0 * L^2
A = Matrix(Zmod(n),[h0,h1,h2])

hn = vector(Zmod(n),[17199707718762989481733793569240992776243099972784327196212023936622130204798694753865087501654381623876011128783229020278210160383185417670794284015692458326761011808048967854332413536183785458993128524881447529380387804712214305034841856237045463243243451585619997751904403447841431924053651568039257094910, 62503976674384744837417986781499538335164333679603320998241675970253762411134672614307594505442798271581593168080110727738181755339828909879977419645331630791420448736959554172731899301884779691119177400457640826361914359964889995618273843955820050051136401731342998940859792560938931787155426766034754760036, 93840121740656543170616546027906623588891573113673113077637257131079221429328035796416874995388795184080636312185908173422461254266536066991205933270191964776577196573147847000446118311985331680378772920169894541350064423243733498672684875039906829095473677927238488927923581806647297338935716890606987700071])
hn_1 = hn * L
hn_2 = hn * L^2
B = Matrix(Zmod(n),[hn,hn_1,hn_2])
M = A.solve_right(B)                                 

L_Jor, P = L.jordan_form(transformation=True)
T = L_Jor
Tn = ~P * M * P
E_m = T[0][0] * Tn[0][1] // Tn[0][0]

for bits in range(1000):
    m = E_m - 2^bits
    flag = long_to_bytes(int(m))
    if b"VNCTF" in flag:
        print(flag)
        # VNCTF{WWhy_diagonalization_1s_s0_brRRRrRrrRrrrRrRRrRRrrrRrRrRuUuUUUTTTtte3333?????ouch!ouch!Th3t_is_S0_Crazy!!!!}
        break
```

