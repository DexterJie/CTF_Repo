由题意知
$$
enc \equiv \sum_{i=0}^{127}m_i\times pubkey_i \mod p
$$
这里计算密度为`0.9921939197933715`

```py
p = 173537234562263850990112795836487093439
pubkey = []
enc = 82516114905258351634653446232397085739

n = len(pubkey)
d = n / log(max(pubkey), 2)
print(CDF(d))
```

密度大于0.94，需要进行一些前置处理，利用已知flag信息，可以将本题转换为8字节未知明文背包，即如下这个式子
$$
enc - known \equiv \sum_{i=55}^{119}m_i\times pubkey_i \mod p
$$
此时计算新的密度为`0.5000727763907822`

```py
p = 173537234562263850990112795836487093439
pubkey = [...]
enc = 82516114905258351634653446232397085739# 先利用已知信息
flag = b'LitCTF{' + b'\x00' * 8 + b'}'
bin_flag = bin(bytes_to_long(flag))[2:]
for i in range(len(flag)):
    enc -= pubkey[i] * int(flag[i])
    enc %= p

new_pubkey = pubkey[-72:-8]
n = len(new_pubkey)
d = n / log(max(new_pubkey), 2)
print(CDF(d))
```

于是造了这个格进行尝试
$$
\begin{pmatrix}
m_{55} & ... & m_{127} & -1 & k
\end{pmatrix}\_{1\times 66}
\begin{pmatrix}
2 & ... & 0  & pubkey_{55}\\
\vdots&\ddots &\vdots&\vdots\\
0 & ... & 2 & pubkey_{127}\\
1 & ... & 1  & c\\
0 & ... &0 &p
\end{pmatrix}\_{66\times 65}
=
\begin{pmatrix}
2m_{55}-1 & ... & 2m_{127}-1 & 0
\end{pmatrix}\_{1\times 65}
$$
无果，接着尝试在右边扩展8列，每一列对应位置有8个1，依次去约束每个字中bit1的个数
$$
\begin{pmatrix}
m_1 & ... & m_n & -1 & k 
\end{pmatrix}\_{1\times 66}
\begin{pmatrix}
2 & ... & 0  & pubkey_1& 1 & ... & 0\\
\vdots&\ddots &\vdots&\vdots&\vdots & \ddots &\vdots \\
0 & ... & 2 & pubkey_n & 0 & ... & 1\\
1 & ... & 1  & c & 0 & ... & 0 &\\
0 & ... &0 &p & -t_1 & ... & -t_8
\end{pmatrix}\_{66\times 73}
=
\begin{pmatrix}
2m_1-1 & ... & 2m_n-1 & 0 & \sum_{i=1}^{8}m_i -t_1 & ... &\sum_{i=56}^{64}m_{i}-t_8 
\end{pmatrix}\_{1\times 73}
$$
依旧无果，在此纠结了很久，看解题数越来越多，想着应该不是特别特别难

回到处理掉flag已知信息的等式
$$
enc - known \equiv \sum_{i=55}^{119}m_i\times pubkey_i \mod p
$$
即
$$
enc-known = \sum_{i=55}^{119}m_i\times pubkey_i - kp
$$
这里只需要求64个未知bit，所以k不会特别大，可以爆破这个k，然后用下面这个格
$$
\begin{pmatrix}
m_{55} & ... & m_{127} & -1
\end{pmatrix}\_{1\times 65}
\begin{pmatrix}
2 & ... & 0  & pubkey_{55}\\
\vdots&\ddots &\vdots&\vdots\\
0 & ... & 2 & pubkey_{127}\\
1 & ... & 1  & S\\
\end{pmatrix}\_{65\times 65}
=
\begin{pmatrix}
2m_{55}-1 & ... & 2m_{127}-1 & 0
\end{pmatrix}\_{1\times 65}
$$
其中`S = enc - known + kp`

```py
# sage10.6
from Crypto.Util.number import *
from tqdm import *

p = 173537234562263850990112795836487093439
pubkey = [184316235755254907483728080281053515467, 301753295242660201987730522100674059399, 214746865948159247109907445342727086153, 190710765981032078577562674498245824397, 331594659178887289573546882792969306963, 325241251857446530306000904015122540537, 183138087354043440402018216471847480597, 184024660891182404534278014517267677121, 221852419056451630727726571924370029193, 252122782233143392994310666727549089119, 175886223097788623718858806338121455451, 275410728642596840638045777234465661687, 251664694235514793799312335012668142813, 218645272462591891220065928162159215543, 312223630454310643034351163568776055567, 246969281206041998865813427647656760287, 314861458279166374375088099707870061461, 264293021895772608566300156292334238719, 300802209357110221724717494354120213867, 293825386566202476683406032420716750733, 280164880535680245461599240490036536891, 223138633045675121340315815489781884671, 194958151408670059556476901479795911187, 180523100489259027750075460231138785329, 180425435626797251881104654861163883059, 313871202884226454316190668965524324023, 184833541398593696671625353250714719537, 217497008601504809464374671355532403921, 246589067140439936215888566305171004301, 289015788017956436490096615142465503023, 301775305365100149653555500258867275677, 185893637147914858767269807046039030871, 319328260264390422708186053639594729851, 196198701308135383224057395173059054757, 231185775704496628532348037721799493511, 243973313872552840389840048418558528537, 213140279661565397451805047456032832611, 310386296949148370235845491986451639013, 228492979916155878048849684460007011451, 240557187581619139147592264130657066299, 187388364905654342761169670127101032713, 305292765113810142043496345097024570233, 303823809595161213886303993298011013599, 227663140954563126349665813092551336597, 257833881948992845466919654910838972461, 291249161813309696736659661907363469657, 228470133121759300620143703381920625589, 337912208888617180835513160742872043511, 252639095930536359128379880984347614689, 306613178720695137374121633131944714277, 328627523443531702430603855075960220403, 283995291614222889691668376952473718279, 185992200035693404743830210660606140043, 175575945935802771832062328390060568381, 239709736751531517044198331233711541211, 325191992201185112802734343474281930993, 285825734319916654888050222626163129503, 260820892372814862728958615462018022903, 271109638409686342632742230596810197399, 195432366301516284662210689868561107229, 252351678712166898804432075801905414141, 175869608753229067314866329908981554323, 212291732707466211705141589249474157597, 299891357045144243959903067354676661051, 271237385422923460052644584552894282763, 268702576849722796315440463412052409241, 198273535005705777854651218089804228523, 177684355989910045168511400849036259973, 189237944200991357454773904466163557789, 175427967765368330787115337317676160499, 270446056495616077936737430232108222303, 243318639972702711024520926308402316247, 223872107662231922057872197123261908053, 268995355861070998347238198063073079851, 244478236168888494353493404999149985963, 230731375083676409248450208772518041369, 231630208287176700035265642824425872113, 187649298194887119502654724235771449423, 264924369987111619306245625770849264491, 327092811483332202721992798797117253283, 274967838920225995524024619709213673571, 313836314009366857157961838519499192671, 181860768653760352435352944732117309357, 184011200837375425882494435177626368109, 246455975565763627776562816894916143559, 262208917125258935991543552004318662109, 334006940602786701813813048552124976177, 241119397420390120456580389194328607351, 255370083166310325724283692646412327547, 280056982387584554076672702548437488901, 190822826881447578202544631446213911541, 206119293866065537243159766877834200177, 289535246575130471484249052043282790337, 222004375767927951747133364917437739627, 186041951615746748538744491355290007923, 299120276948597373232905692530626175519, 268645812049699572580085139845553457511, 231990902203442306941381714523426756489, 259677531562170067444672097354970172129, 232573792063456357545735601063504090387, 268451806037215206985127877726665463011, 324266632324016349795115268035757999593, 323952615081869295386415078624753400501, 302316593553669781596237136546083536339, 235576231941572491681115931798290883659, 202271277470197960243533508432663735031, 172391954991101354275650988921310984563, 215333185856183701105529790905068832303, 335916893044781805453250006520700519353, 217268288923298532517983372665872329797, 265455575922780577837866687874732212733, 182194442259001995170676842797322170297, 180222796978664332193987060700843734759, 332629077640484670095070754759241249101, 238815683708676274248277883404136375767, 246167709707533867216616011486975023679, 188375282015595301232040104228085154549, 230675799347049231846866057019582889423, 290911573230654740468234181613682439691, 173178956820933028868714760884278201561, 340087079300305236498945763514358009773, 215775253913162994758086261347636015049, 286306008278685809877266756697807931889, 175231652202310718229276393280541484041, 230887015177563361309867021497576716609, 306478031708687513424095160106047572447, 172289054804425429042492673052057816187]
enc = 82516114905258351634653446232397085739

known = b'LitCTF{' + b'\x00'*8 + b'}'
bin_known = bin(bytes_to_long(known))[2:]
for i in range(len(bin_known)):
    enc -= pubkey[i] * int(bin_known[i])
    enc %= p

new_pubkey = pubkey[-72:-8]
n = len(new_pubkey)
d = n / log(max(new_pubkey), 2)
print(CDF(d))

for k in trange(256):
    S = enc + k*p
    L = Matrix(ZZ,n+1,n+1)
    for i in range(n):
        L[i,i] = 2
        L[-1,i] = 1
        L[i,-1] = new_pubkey[i]
    L[-1,-1] = S
    L[:,-1] *= 2^200

    for line in L.LLL():
        if set(line[:-1]).issubset({-1,1}):
            m = ''
            for i in line[:-1]:
                if i == 1:
                    m += '0'
                else:
                    m += '1'
            flag = b'LitCTF{' + long_to_bytes(int(m,2)) + b'}'
            print(flag)
            # LitCTF{Am3xItsT}
```









